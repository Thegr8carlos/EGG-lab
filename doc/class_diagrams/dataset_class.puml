@startuml
title Clase Dataset - Gestión de Datos EEG

class Dataset {
  - path : str
  - name : str
  - extensions_enabled : List[str]

  + __init__(path, name)
  + upload_dataset(path_to_folder) : dict
  + read_bdf(path) : mne.io.Raw
  + read_edf(path) : mne.io.Raw
  + read_brainvision(path) : mne.io.Raw

  {static} + get_events_by_class(path, class_name) : dict
  {static} + load_events(path) : dict
  {static} + load_signal_data(file_path) : tuple
  {static} + get_channel_mapping(dataset_name) : dict
  {static} + extract_channels(data, channels, dataset) : ndarray
  {static} + create_subset_dataset(dataset, percent, split, seed, materialize, model_type) : Tuple
}

note right of Dataset
  Gestión completa de datos EEG

  Funciones principales:
  1. Carga de archivos EEG (BDF/EDF/BrainVision)
  2. Extracción de eventos con timestamps
  3. Mapeo y selección de canales
  4. Creación de conjuntos train/test
  5. Cálculo y guardado de metadatos

  Soporta múltiples datasets:
  - BNCI2014-001 (64 canales)
  - BNCI2014-004 (3 canales)
  - Nieto Inner Speech (137 canales)
  - Datasets genéricos
end note

note bottom of Dataset
  **upload_dataset() - Flujo principal:**

  1. Escanear archivos .bdf/.edf/.vhdr
  2. Cargar señal cruda con MNE
  3. Detectar tipo de dataset (Inner Speech vs Genérico)
  4. Extraer eventos (timestamps + IDs)
  5. Crear ventanas temporales alrededor de eventos
  6. Calcular metadata completo:
     • Frecuencia de muestreo
     • Número de canales y nombres
     • Estadísticas por canal (media, std, min, max)
     • Potencia en bandas de frecuencia:
       delta (0.5-4 Hz), theta (4-8 Hz),
       alpha (8-13 Hz), beta (13-30 Hz), gamma (30-100 Hz)
     • Detección de canales problemáticos
  7. Guardar en Aux/ (estructura paralela a Data/)

  **Procesamiento específico de Inner Speech:**
  - Filtra eventos dentro de runs de inner speech (marker 22)
  - Mapeo de IDs: 31=arriba, 32=abajo, 33=derecha, 34=izquierda
  - Cuenta eventos por clase para validación

  **create_subset_dataset():**
  - División estratificada (mantiene distribución de clases)
  - Seed fijo para reproducibilidad
  - Materialización opcional (aplicar filtros y transformadas)
  - Genera manifest con paths, labels y metadata
end note

@enduml
